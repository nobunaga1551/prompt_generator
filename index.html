<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Segoe UI', 'Yu Gothic UI', sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  padding: 20px;
}

.container {
  max-width: 1000px;
  margin: 0 auto;
  background: #fff;
  border-radius: 16px;
  padding: 28px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.25);
}

h1 { font-size: 20px; color: #2d3748; margin-bottom: 4px; }
.subtitle { color: #718096; font-size: 12px; margin-bottom: 20px; }

/* ä»»æ„ã‚¿ã‚° ãƒˆã‚°ãƒ«ãƒ‘ãƒãƒ« */
.opt-panel {
  background: #f7fafc;
  border: 1.5px solid #e2e8f0;
  border-radius: 10px;
  padding: 14px 18px;
  margin-bottom: 18px;
}
.opt-panel-title {
  font-size: 11px;
  font-weight: 700;
  color: #718096;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-bottom: 10px;
}
.opt-pills { display: flex; flex-wrap: wrap; gap: 8px; }

.pill {
  display: flex;
  align-items: center;
  gap: 5px;
  padding: 6px 14px;
  background: #fff;
  border: 1.5px solid #e2e8f0;
  border-radius: 20px;
  font-size: 13px;
  cursor: pointer;
  transition: all 0.2s;
  user-select: none;
}
.pill:hover { border-color: #5a67d8; color: #5a67d8; }
.pill.on { background: #ebf4ff; border-color: #5a67d8; color: #5a67d8; font-weight: 600; }
.pill input { display: none; }
.pill-icon { font-size: 12px; }

/* ãƒ†ãƒ¼ãƒ–ãƒ« */
table { width: 100%; border-collapse: collapse; }
thead th {
  background: #5a67d8; color: #fff;
  padding: 10px 12px;
  font-size: 12px; font-weight: 600;
  text-align: left;
}
thead th:first-child { border-radius: 8px 0 0 0; }
thead th:last-child  { border-radius: 0 8px 0 0; }
tbody tr { transition: background 0.15s; }
tbody tr:nth-child(even) { background: #f7fafc; }
tbody tr:hover { background: #ebf4ff; }
td { padding: 8px; vertical-align: middle; border-bottom: 1px solid #e2e8f0; }

.td-num { width: 32px; text-align: center; color: #a0aec0; font-size: 12px; }
.td-tag { width: 200px; vertical-align: top; padding-top: 12px; }
.tag-label {
  font-family: 'Consolas', 'Courier New', monospace;
  font-size: 13px; font-weight: 700; color: #2d3748;
}
.badge {
  display: inline-block;
  font-size: 10px; padding: 1px 7px;
  border-radius: 10px; margin-top: 3px;
}
.req { background: #c6f6d5; color: #276749; }
.opt { background: #e9d8fd; color: #6b46c1; }

textarea {
  width: 100%; padding: 8px 10px;
  border: 1.5px solid #e2e8f0; border-radius: 6px;
  font-size: 13px; font-family: inherit;
  resize: vertical; min-height: 52px; line-height: 1.5;
  transition: border-color 0.2s;
}
textarea:focus {
  outline: none; border-color: #5a67d8;
  box-shadow: 0 0 0 3px rgba(90,103,216,0.15);
}

/* ç§»å‹•ãƒœã‚¿ãƒ³ */
.td-move { width: 48px; text-align: center; }
.move-wrap { display: flex; flex-direction: column; gap: 3px; align-items: center; }
.btn-mv {
  width: 26px; height: 22px;
  background: #edf2f7; color: #4a5568;
  border: 1px solid #e2e8f0; border-radius: 4px;
  font-size: 10px; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.15s;
}
.btn-mv:hover:not(:disabled) { background: #5a67d8; color: #fff; border-color: #5a67d8; }
.btn-mv:disabled { opacity: 0.2; cursor: default; }

/* ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ */
.toolbar {
  display: flex; gap: 10px;
  margin: 16px 0 20px;
  align-items: center; flex-wrap: wrap;
}
.btn {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 9px 18px; border: none; border-radius: 8px;
  font-size: 13px; font-weight: 600; cursor: pointer;
  font-family: inherit; transition: all 0.2s;
}
.btn:hover { transform: translateY(-1px); }
.btn-save     { background: #e2e8f0; color: #4a5568; }
.btn-save:hover { background: #cbd5e0; }
.btn-save.done  { background: #c6f6d5; color: #276749; }
.btn-reset    { background: #fff; color: #e53e3e; border: 1.5px solid #fed7d7; }
.btn-reset:hover { background: #fff5f5; }
.btn-gen      { background: #5a67d8; color: #fff; margin-left: auto; }
.btn-gen:hover { background: #4c51bf; box-shadow: 0 4px 12px rgba(90,103,216,0.4); }
.save-ts { font-size: 11px; color: #a0aec0; }

/* å‡ºåŠ› */
.out-card {
  margin-top: 20px;
  border: 1.5px solid #c6f6d5;
  border-radius: 12px; overflow: hidden;
  display: none;
}
.out-header {
  background: #f0fff4; padding: 12px 18px;
  display: flex; justify-content: space-between;
  align-items: center; flex-wrap: wrap; gap: 8px;
}
.out-title { font-weight: 700; color: #276749; font-size: 14px; }
.copy-row  { display: flex; align-items: center; gap: 10px; }
.copy-badge {
  background: #c6f6d5; color: #276749;
  padding: 3px 10px; border-radius: 20px;
  font-size: 12px; font-weight: 600;
  opacity: 0; transition: opacity 0.3s;
}
.copy-badge.on { opacity: 1; }
.btn-copy { background: #38a169; color: #fff; padding: 10px 22px; font-size: 14px; }
.btn-copy:hover { background: #2f855a; box-shadow: 0 4px 12px rgba(56,161,105,0.4); }

#outputText {
  display: block; width: 100%;
  padding: 14px 18px; border: none;
  font-family: 'Consolas', 'Courier New', monospace;
  font-size: 13px; line-height: 1.75;
  background: #fafafa; resize: vertical; min-height: 260px;
  color: #2d3748;
}
#outputText:focus { outline: none; }
.char-count {
  text-align: right; padding: 6px 18px;
  font-size: 12px; color: #718096;
  background: #f7fafc; border-top: 1px solid #e2e8f0;
}
</style>
</head>
<body>
<div class="container">
  <h1>ğŸš€ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
  <p class="subtitle">
    å¿…é ˆã‚¿ã‚°ï¼ˆ4ï¼‰ã¯å¸¸æ™‚è¡¨ç¤º ï¼ ä»»æ„ã‚¿ã‚°ï¼ˆ4ï¼‰ã¯ã‚¯ãƒªãƒƒã‚¯ã§è¿½åŠ  ï¼ â–²â–¼ã§é †ç•ªå¤‰æ›´ ï¼ é †ç•ªã¯ä¿å­˜å¯
  </p>

  <!-- ä»»æ„ã‚¿ã‚°åˆ‡ã‚Šæ›¿ãˆ -->
  <div class="opt-panel">
    <div class="opt-panel-title">ä»»æ„ã‚¿ã‚° â€” ã‚¯ãƒªãƒƒã‚¯ã§è¿½åŠ  / éè¡¨ç¤º</div>
    <div class="opt-pills" id="optPills"></div>
  </div>

  <!-- å…¥åŠ›ãƒ†ãƒ¼ãƒ–ãƒ« -->
  <table>
    <thead>
      <tr>
        <th style="width:32px">#</th>
        <th style="width:200px">ã‚¿ã‚°</th>
        <th>å†…å®¹</th>
        <th style="width:48px; text-align:center">é †ç•ª</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <div class="toolbar">
    <button class="btn btn-save" id="saveBtn" onclick="saveOrder()">ğŸ’¾ ã‚¿ã‚°é †ã‚’ä¿å­˜</button>
    <button class="btn btn-reset" onclick="resetOrder()">â†º ãƒªã‚»ãƒƒãƒˆ</button>
    <span class="save-ts" id="saveTs"></span>
    <button class="btn btn-gen" onclick="generate()">âš¡ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ</button>
  </div>

  <!-- å‡ºåŠ› -->
  <div class="out-card" id="outCard">
    <div class="out-header">
      <span class="out-title">ğŸ“„ ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</span>
      <div class="copy-row">
        <span class="copy-badge" id="copyBadge">âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼</span>
        <button class="btn btn-copy" id="copyBtn" onclick="copyAll()">ğŸ“‹ ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã‚³ãƒ”ãƒ¼</button>
      </div>
    </div>
    <textarea id="outputText" readonly></textarea>
    <div class="char-count" id="charCount"></div>
  </div>
</div>

<script>
// â”€â”€â”€ å®šæ•° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const REQUIRED = ['Objective', 'Persona', 'Instructions', 'Context'];
const OPTIONAL  = ['Constraints', 'Response format', 'Reasoning steps', 'Examples'];
const ALL_TAGS  = [...REQUIRED, ...OPTIONAL];

const LS_ORDER = 'pg_tag_order_v2';
const LS_OPT   = 'pg_optional_v2';

// â”€â”€â”€ çŠ¶æ…‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let tagOrder      = loadOrder();        // å…¨ã‚¿ã‚°ã®ä¸¦ã³é †ï¼ˆéè¡¨ç¤ºã®ã‚‚ã®ã‚‚ä¿æŒï¼‰
let activeOptional = new Set(loadOpt()); // ç¾åœ¨è¡¨ç¤ºä¸­ã®ä»»æ„ã‚¿ã‚°

// â”€â”€â”€ LocalStorage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadOrder() {
  try {
    const s = JSON.parse(localStorage.getItem(LS_ORDER));
    if (Array.isArray(s)) {
      const filtered = s.filter(t => ALL_TAGS.includes(t));
      // æ¼ã‚ŒãŸå¿…é ˆã‚¿ã‚°ã‚’æœ«å°¾è£œå®Œ
      REQUIRED.forEach(t => { if (!filtered.includes(t)) filtered.push(t); });
      return filtered;
    }
  } catch {}
  return [...REQUIRED];
}

function loadOpt() {
  try {
    const s = JSON.parse(localStorage.getItem(LS_OPT));
    if (Array.isArray(s)) return s.filter(t => OPTIONAL.includes(t));
  } catch {}
  return [];
}

// â”€â”€â”€ åˆæœŸåŒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function init() {
  renderPills();
  renderTable();
}

// â”€â”€â”€ ä»»æ„ã‚¿ã‚° ãƒ”ãƒ« â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderPills() {
  const wrap = document.getElementById('optPills');
  wrap.innerHTML = '';
  OPTIONAL.forEach(tag => {
    const lbl = document.createElement('label');
    const on  = activeOptional.has(tag);
    lbl.className = 'pill' + (on ? ' on' : '');
    lbl.innerHTML = `
      <input type="checkbox" ${on ? 'checked' : ''}>
      <span class="pill-icon">${on ? 'âœ“' : 'ï¼‹'}</span>
      <span>${tag}</span>`;
    lbl.querySelector('input').addEventListener('change', e => {
      if (e.target.checked) {
        activeOptional.add(tag);
        if (!tagOrder.includes(tag)) tagOrder.push(tag); // æœ«å°¾ã«è¿½åŠ 
      } else {
        activeOptional.delete(tag);
        // tagOrder ã«ã¯æ®‹ã™ï¼ˆä½ç½®è¨˜æ†¶ã®ãŸã‚ï¼‰
      }
      renderPills();
      renderTable();
    });
    wrap.appendChild(lbl);
  });
}

// â”€â”€â”€ ãƒ†ãƒ¼ãƒ–ãƒ«æç”» â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getVisible() {
  const vis = [];
  tagOrder.forEach(t => {
    if (REQUIRED.includes(t) || activeOptional.has(t)) vis.push(t);
  });
  // ä¸‡ãŒä¸€æ¼ã‚ŒãŸå¿…é ˆã‚¿ã‚°ã‚’è£œå®Œ
  REQUIRED.forEach(t => { if (!vis.includes(t)) vis.push(t); });
  return vis;
}

function renderTable() {
  const tbody = document.getElementById('tbody');
  const vis   = getVisible();

  // å…¥åŠ›æ¸ˆã¿å†…å®¹ã‚’é€€é¿
  const saved = {};
  tbody.querySelectorAll('tr[data-tag]').forEach(tr => {
    saved[tr.dataset.tag] = tr.querySelector('textarea').value;
  });

  tbody.innerHTML = '';
  vis.forEach((tag, i) => {
    const isReq = REQUIRED.includes(tag);
    const tr = document.createElement('tr');
    tr.dataset.tag = tag;
    tr.innerHTML = `
      <td class="td-num">${i + 1}</td>
      <td class="td-tag">
        <div class="tag-label">&lt;${tag}&gt;</div>
        <span class="badge ${isReq ? 'req' : 'opt'}">${isReq ? 'å¿…é ˆ' : 'ä»»æ„'}</span>
      </td>
      <td><textarea placeholder="å†…å®¹ã‚’å…¥åŠ›â€¦"></textarea></td>
      <td class="td-move">
        <div class="move-wrap">
          <button class="btn-mv" title="ä¸Šã¸"
            onclick="move(this,-1)" ${i === 0 ? 'disabled' : ''}>â–²</button>
          <button class="btn-mv" title="ä¸‹ã¸"
            onclick="move(this,1)"  ${i === vis.length - 1 ? 'disabled' : ''}>â–¼</button>
        </div>
      </td>`;
    if (saved[tag]) tr.querySelector('textarea').value = saved[tag];
    tbody.appendChild(tr);
  });
}

// â”€â”€â”€ è¡Œç§»å‹• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function move(btn, dir) {
  const tag = btn.closest('tr').dataset.tag;
  const vis = getVisible();
  const i   = vis.indexOf(tag);
  const j   = i + dir;
  if (j < 0 || j >= vis.length) return;

  // tagOrder ä¸Šã§2ã‚¿ã‚°ã®ä½ç½®ã‚’ swap
  const pi = tagOrder.indexOf(vis[i]);
  const pj = tagOrder.indexOf(vis[j]);
  [tagOrder[pi], tagOrder[pj]] = [tagOrder[pj], tagOrder[pi]];

  renderTable();
}

// â”€â”€â”€ ä¿å­˜ / ãƒªã‚»ãƒƒãƒˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveOrder() {
  localStorage.setItem(LS_ORDER, JSON.stringify(tagOrder));
  localStorage.setItem(LS_OPT,   JSON.stringify([...activeOptional]));

  const btn = document.getElementById('saveBtn');
  btn.textContent = 'âœ… ä¿å­˜ã—ã¾ã—ãŸ';
  btn.classList.add('done');
  document.getElementById('saveTs').textContent =
    new Date().toLocaleTimeString('ja-JP') + ' ã«ä¿å­˜';
  setTimeout(() => {
    btn.textContent = 'ğŸ’¾ ã‚¿ã‚°é †ã‚’ä¿å­˜';
    btn.classList.remove('done');
  }, 2000);
}

function resetOrder() {
  if (!confirm('ã‚¿ã‚°ã®é †ç•ªã¨ä»»æ„ã‚¿ã‚°ã®é¸æŠã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ')) return;
  localStorage.removeItem(LS_ORDER);
  localStorage.removeItem(LS_OPT);
  tagOrder       = [...REQUIRED];
  activeOptional = new Set();
  renderPills();
  renderTable();
  document.getElementById('saveTs').textContent = '';
}

// â”€â”€â”€ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generate() {
  let result = '';
  document.querySelectorAll('#tbody tr[data-tag]').forEach(tr => {
    const tag     = tr.dataset.tag;
    const content = tr.querySelector('textarea').value.trim();
    result += `<${tag}>\n${content}\n</${tag}>\n\n\n`;
  });
  result = result.replace(/\n+$/, '');

  if (!result.trim()) { alert('å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); return; }

  document.getElementById('outputText').value  = result;
  document.getElementById('charCount').textContent =
    `æ–‡å­—æ•°: ${result.length.toLocaleString()} æ–‡å­—`;

  const card = document.getElementById('outCard');
  card.style.display = 'block';
  card.scrollIntoView({ behavior: 'smooth', block: 'start' });

  clip(result, true);
}

// â”€â”€â”€ ã‚³ãƒ”ãƒ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function copyAll() { clip(document.getElementById('outputText').value, false); }

function clip(text, auto) {
  navigator.clipboard.writeText(text)
    .then(() => feedback(auto))
    .catch(() => {
      document.getElementById('outputText').select();
      document.execCommand('copy');
      feedback(auto);
    });
}

function feedback(auto) {
  if (!auto) {
    const b = document.getElementById('copyBadge');
    b.classList.add('on');
    setTimeout(() => b.classList.remove('on'), 2500);
  }
  const btn = document.getElementById('copyBtn');
  btn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼æ¸ˆã¿ï¼';
  setTimeout(() => btn.textContent = 'ğŸ“‹ ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã‚³ãƒ”ãƒ¼', 2000);
}

init();
</script>
</body>
</html>
